C51 COMPILER V9.54   UART                                                                  04/07/2019 11:45:19 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN ..\OBJ\uart.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE ..\HARDWARE\uart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\HARDWARE) DEBUG OBJEC
                    -TEXTEND PRINT(.\Listings\uart.lst) TABS(2) OBJECT(..\OBJ\uart.obj)

line level    source

   1          #include "uart.h"
   2          /*************  本地常量声明  **************/
   3          #define MAIN_Fosc   11059200L //定义主时钟
   4          #define RX1_Lenth   32      //串口接收缓冲长度
   5          #define BaudRate1   115200UL  //选择波特率
   6          
   7          
   8          #define Timer1_Reload (65536UL -(MAIN_Fosc / 4 / BaudRate1))    //Timer 1 重装值， 对应300KHZ
   9          #define Timer2_Reload (65536UL -(MAIN_Fosc / 4 / BaudRate1))    //Timer 2 重装值， 对应300KHZ
  10          
  11          
  12          
  13          void UsartInit(void)
  14          {
  15   1      SCON  = (SCON & 0x3f) | 0x40;       //8位数据
  16   1        P_SW1 &= ~0xc0;   //UART1 使用P30 P31口 默认
  17   1      
  18   1        AUXR &= ~(1<<4);  //Timer stop    波特率使用Timer2产生
  19   1        AUXR |= 0x01;   //S1 BRT Use Timer2;
  20   1        AUXR |=  (1<<2);  //Timer2 set as 1T mode
  21   1        T2H = (u8)(Timer2_Reload >> 8);
  22   1        T2L = (u8)Timer2_Reload;
  23   1        AUXR |=  (1<<4);  //Timer run enable
  24   1      
  25   1        REN = 1;  //允许接收
  26   1        ES  = 1;  //允许中断
  27   1      
  28   1        EA = 1;   //允许全局中断
  29   1      }
  30          
  31          
  32          /********************* UART1中断函数************************/
  33          void Usart() interrupt 4
  34          { 
  35   1        u8 receiveData;
  36   1      
  37   1        receiveData=SBUF;//出去接收到的数据
  38   1        RI = 0;//清除接收中断标志位
  39   1        SBUF=receiveData;//将接收到的数据放入到发送寄存器
  40   1        while(!TI);      //等待发送数据完成
  41   1        TI=0;            //清除发送完成标志位
  42   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     59    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
