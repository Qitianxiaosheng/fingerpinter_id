C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE FPM
OBJECT MODULE PLACED IN ..\OBJ\fpm.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE ..\HARDWARE\fpm.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\HARDWARE) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\fpm.lst) TABS(2) OBJECT(..\OBJ\fpm.obj)

line level    source

   1          #include "fpm.h"
   2          
   3          
   4          unsigned char   idy_stop_flag=0;
   5          unsigned char   SaveNumber=0,searchnum=0;
   6          unsigned int    SearchNumber=0;   
   7          bit changeflag=0,modeflag=0,clearallflag=0;  
   8          //Verify  Password   £ºÑéÖ¤Éè±¸ÎÕÊÖ¿ÚÁî
   9          unsigned char  VPWD[16]={16,0X01 ,0Xff,0xff,0xff,0xff, 0x01,0,7,0x13,0x00,0x00,0x00,0x00,0x00,0x1b};   //»Ø
             -ËÍ12¸ö
  10          
  11          //ÉèÖÃÉè±¸ÎÕÊÖ¿ÚÁî
  12          unsigned char code STWD[16]={16,0X01 ,0Xff,0xff,0xff,0xff, 0x01,0,7,0x12,0x00,0x00,0x00,0x00,0x00,0x1a};   
             -//»ØËÍ12¸ö
  13          
  14          //GetImage           £ºÌ½²âÊÖÖ¸²¢´Ó´«¸ÐÆ÷ÉÏ¶ÁÈëÍ¼Ïñ
  15          unsigned char code GIMG[14]={12, 0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,3,1,0x00,0x05}; //»ØËÍ12¸ö
  16          
  17          //Gen Templet1        £º¸ù¾ÝÔ­Ê¼Í¼ÏñÉú³ÉÖ¸ÎÆÌØÕ÷1
  18          unsigned char code GENT1[14]={13,0X01 ,0Xff,0xff,0xff,0xff,0x01,0,4,2,1,0x00,0x08}; //»ØËÍ12¸ö
  19          
  20          //Gen Templet2        £º¸ù¾ÝÔ­Ê¼Í¼ÏñÉú³ÉÖ¸ÎÆÌØÕ÷2
  21          unsigned char code GENT2[14]={13,0X01 ,0Xff,0xff,0xff,0xff,0x01,0,4,2,2,0x00,0x09}; //»ØËÍ12¸ö  
  22          
  23            
  24          //Search Finger      £ºÒÔCharBufferA»òCharBufferBÖÐµÄÌØÕ÷ÎÄ¼þËÑË÷Õû¸ö»ò²¿·ÖÖ¸ÎÆ¿â
  25          unsigned char code SEAT[18]={17,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,   0,8, 4,1,0,0,    0,0x65,  0x00,0x73};
             -  //»ØËÍ16¸ö
  26          
  27          
  28          //Merge Templet      ;½«CharBufferAÓëCharBufferBÖÐµÄÌØÕ÷ÎÄ¼þºÏ²¢Éú³ÉÄ£°å£¬½á¹û´æÓÚModelBuffer¡£
  29          unsigned char code MERG[14]={12,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,  0,3,5 , 0x00,0x09};//»ØËÍ12¸ö 
  30          
  31          //Store Templet      £º½«ModelBufferÖÐµÄÎÄ¼þ´¢´æµ½flashÖ¸ÎÆ¿âÖÐ
  32          unsigned char code STOR[16]={15,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,  0,6,6,2,     0x00,0x00,     0x00,0x0f}
             -; //»ØËÍ12¸ö
  33          
  34          //Read Note
  35          unsigned char code RDNT[14]={13,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,4,0x19,  0, 0x00,0x1e};
  36          
  37          //Clear Note
  38          unsigned char code DENT[46]={45,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,36,0x18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
             -,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x00,0x3d};
  39          
  40          //DEL one templet
  41          unsigned char code DELE_one[16]={16, 0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,7,  0x0c,0x00,0x00, 0,1, 0x00,0x15
             -};
  42          
  43          //DEL templet      ;Çå¿ÕÖ¸ÎÆ¿â
  44          unsigned char code DELE_all[12]={12,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,3,  0x0d,0x00,0x11};
  45          
  46          
  47          ////////////////³£ÓÃÖ¸Áî¶¨Òå-------½áÊø///////////////////////////////////////////////////////////////////
             -////////////////////
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 2   

  48          unsigned char     FifoNumber=0; 
  49          unsigned char   FIFO[MAX_NUMBER+1]={0};
  50          
  51          
  52          unsigned char send_command( unsigned char *p)
  53          {
  54   1          unsigned char count=0,tmpdat=0,temp=0,i=0,package=0,flag=0,checksum=0;
  55   1          TxdByte(0xef);//Êý¾Ý°ü°üÍ·Ê¶±ðÂë
  56   1          delay_us(100);
  57   1          TxdByte(0x01);//Êý¾Ý°ü°üÍ·Ê¶±ðÂë
  58   1          delay_us(100);
  59   1          i=*p;         //Êý×éµÄµÚ¡°0¡±¸öÔªËØ¡¢ÀïÃæ´æ·ÅÁË±¾Êý×éµÄ³¤¶È£¬°ÑÕâ¸ö³¤¶È¸ø±äÁ¿i£¬·½±ã½øÐÐ²Ù×÷
  60   1          p++;
  61   1          p++;
  62   1          for (count=i-1; count!=1;count--)  //Sent command String
  63   1          {
  64   2            temp=*p++;    //È¡µÚ¸ö¡°1¡±¸öÔªËØµÄÄÚÈÝ£¬È»ºó·¢ËÍ 
  65   2            TxdByte(temp);//½«Êý¾Ý·¢ËÍ³öÈ¥
  66   2            delay_us(100);
  67   2          }  
  68   1          return 1;//·¢ËÍÍê³É,½á¹ûÎªÕæ (ÕæÎª1)    
  69   1      }
  70            
  71          bit Command(unsigned char *p,unsigned char MaxTime) //ÃüÁî½âÎö,¸øÄ£¿é·¢ËÍÒ»¸öÃüÁî
  72          {
  73   1          unsigned char count=0,tmpdat=0,temp=0,i=0,package=0,flag=0,checksum=0;
  74   1            
  75   1         bit result=0, start=0,stop=0;
  76   1         send_command(p);
  77   1          result=TURE;//·¢ËÍÍê³É,½á¹ûÎªÕæ (ÕæÎª1)     
  78   1          FifoNumber=0;
  79   1          for (count=MAX_NUMBER+1; count!=0; count--)//Çå¿ÕËùÓÐFIFO[]Êý×éÀïÃæµÄÄÚÈÝ£¬Ð´Èë0X00
  80   1           FIFO[count-1]=0x00;  
  81   1          if (result)   
  82   1          {   
  83   2            result=FALSE;
  84   2              start =FALSE;
  85   2            stop  =FALSE;
  86   2              count=0;
  87   2              clk0=0; //ÇåÁãCL0¼ÆÊý
  88   2          
  89   2              do /////////////////////////////doµÄÄÚÈÝ////////////////////////////////
  90   2          { 
  91   3            restart0:       
  92   3                  if ((S2CON &0x01)==1)//Èç¹û½ÓÊÕµ½Êý¾Ý
  93   3                  {         
  94   4                  tmpdat=S2BUF;//ÏÈ°Ñ½ÓÊÕµ½µÄÊý¾Ý·Åµ½tmpdatÖÐ
  95   4                      S2CON &= ~0x01;
  96   4                      if ((tmpdat==0xef)&&(start==FALSE))//Õâ¸öÊý¾ÝÎªµÚÒ»¸ö´«»ØÀ´µÄÊý¾Ý£¬Ò²¾ÍÊÇ¡°Ö¸ÁîÓ¦´ð¡±µÄµÚÒ»¸
             -ö×Ö½Ú
  97   4                        { 
  98   5                    count=0;
  99   5                      FIFO[0]=tmpdat;//¶ÁÈëµÚÒ»¸öÓ¦´ð×Ö½Ú(0XEF)£¬´æÔÚµÚ¡°0¡±¸öÔªËØÖÐ    
 100   5                    flag=1; 
 101   5                    goto 
 102   5                      restart0;//¿ÉÒÔÓÃÖÐ¶Ï·½Ê½½øÐÐ     
 103   5                        
 104   5                        }
 105   4                if(flag==1)//µÚÒ»¸ö×Ö½ÚÒÑ¾­»ØÀ´£¬ËùÒÔflag==1³ÉÁ¢
 106   4                  {  
 107   5                    if(tmpdat!=0x01)  //½ÓÊÕÊý¾Ý´íÎó£¬½«ÖØÐÂ´Ó»º³åÇø½ÓÊÕÊý¾Ý
 108   5                    {   
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 3   

 109   6                      flag=0;//½ÓÊÕÓ¦´ðÊ§°Ü
 110   6                      result=FALSE;
 111   6                          start =FALSE;
 112   6                        stop=FALSE;
 113   6                          count=0;
 114   6                      goto 
 115   6                        restart0;         
 116   6                    
 117   6                    }
 118   5                    //Èç¹û³É¹¦½ÓÊÕµ½0xef01£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾Ý
 119   5                    flag=2;//flag=2;±íÊ¾Ó¦´ð³É¹¦£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾ÝÁË
 120   5                    count++;//ÏÖÔÚcount=1;
 121   5                    FIFO[count]=tmpdat;//¶ÁÈëµÚ¶þ¸öÓ¦´ð×Ö½Ú£¨0X01£©£¬´æÔÚµÚ¡°1¡±¸öÔªËØÖÐ    
 122   5                    start=TURE; //Ó¦´ð³É¹¦¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾Ý
 123   5                        goto 
 124   5                        restart0; 
 125   5                  }                  
 126   4                      if((flag==2)&&(start==TURE))//flag=2;±íÊ¾Ó¦´ð³É¹¦£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾ÝÁË
 127   4                        {                  
 128   5                      count++; //Êý¾ÝÔªËØÏÂ±ê£«£«
 129   5                          FIFO[count]=tmpdat;//´æÈëÊý¾Ý
 130   5                    if(count>=6)
 131   5                      {
 132   6                        checksum=FIFO[count]+checksum; //¼ÆËãÐ£ÑéºÍ
 133   6                      }
 134   5                    if(count==8)
 135   5                      { 
 136   6                        package=FIFO[7]*0X100+FIFO[8];  //¼ÆËã°ü³¤¶È              
 137   6                        stop= TURE;
 138   6                      }
 139   5                    if(stop)
 140   5                      {           
 141   6                        if(count==package+8)
 142   6                        {
 143   7                          checksum=checksum-FIFO[count-1] - FIFO[count];
 144   7                          if(checksum != (FIFO[count]&0xff)) 
 145   7                            result=FALSE; //Ð£ÑéÊ§°Ü,ÖÃ½á¹û±êÖ¾Îª0              
 146   7                          else 
 147   7                            result=TURE;
 148   7                          flag=0;
 149   7                          break;
 150   7                        } 
 151   6                      }
 152   5                        }
 153   4                  }
 154   3                }/////////////////////////////doµÄÄÚÈÝ----------------½áÊø////////////////////////////////
 155   2             
 156   2          while ((clk0 <= MaxTime) && (count <= MAX_NUMBER) && (changeflag==0)); //ÓÉ¶¨Ê±Æ÷ÒÔ¼°×î´ó½ÓÊÕÊý¾ÝÀ´¿ØÖÆ£
             -¬±£Ö¤²»»áÔÚ´ËÒ»Ö±Ñ­»·
 157   2            
 158   2              FifoNumber=count; //±£´æ½ÓÊÕµ½µÄÊý¾Ý¸öÊý
 159   2         }
 160   1         return (result);
 161   1      }
 162          
 163          
 164          bit VefPSW(void)//ÑéÖ¤Éè±¸ÎÕÊÖ¿ÚÁî,³É¹¦·µ»Ø1     
 165          {
 166   1        unsigned char  count=0;
 167   1        while (1)
 168   1          {
 169   2            if(Command(VPWD,20) && (FifoNumber==11) && (FIFO[9]==0x00))  
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 4   

 170   2            return(1);
 171   2            count++;
 172   2              if (count>=2)//Èç¹û²»³É¹¦£¬ÔÙÑéÖ¤Ò»´Î£¬Èç¹ûÁ½´Î²»³É¹¦£¬·µ»ØÊ§°Ü
 173   2                {  
 174   3                    return(0);   
 175   3              }
 176   2        }
 177   1      }
 178          
 179          
 180          void Clear_All(void) //Çå¿ÕÖ¸ÎÆ¿â   
 181          {       
 182   1            delay_ms(200);
 183   1          Command(DELE_all,50); //Çå¿ÕÖ¸ÎÆ¿â      
 184   1      }
 185          void Clear_ONE(u8 num) //Çå¿ÕÖ¸ÎÆ¿â   
 186          {     
 187   1          if(Command(DELE_one,60) && (FifoNumber==11) && (FIFO[9]==0x00) )  
 188   1          {
 189   2              return 1;
*** ERROR C174 IN LINE 189 OF ..\HARDWARE\fpm.c: return-expression on void-function
 190   2          }     
 191   1          else             
 192   1          {
 193   2              return 0;
 194   2          }   
 195   1            delay_ms(200);    
 196   1      }
 197          
 198          
 199          
 200          unsigned char ImgProcess(unsigned char BUFID)  //·¢»ñÈ¡Í¼Ïñ²¢Éú³ÉÌØÕ÷ÎÄ¼þ£¬´æÈëBUFIDÖÐ//ÊäÈë²ÎÊýÎª»º³åÇøºÅ
             -  
 201          { 
 202   1          if(Command(GIMG,89) && (FifoNumber==11) && (FIFO[9]==0x00))  
 203   1          {
 204   2          if(BUFID==1)      
 205   2          {         
 206   3                if(Command(GENT1,60) && (FifoNumber==11) && (FIFO[9]==0x00))  
 207   3                {             
 208   4              return 1;
 209   4            }  
 210   3                else
 211   3                {
 212   4                return 0;
 213   4                }
 214   3           }
 215   2          else if(BUFID==2)
 216   2          {
 217   3              if(Command(GENT2,60) && (FifoNumber==11) && (FIFO[9]==0x00))  
 218   3                {       
 219   4              return 1;
 220   4            }  
 221   3                else
 222   3                {
 223   4                return 0;
 224   4                }     
 225   3          }
 226   2          }
 227   1          else
 228   1          {
 229   2            return 0;       
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 5   

 230   2          } 
 231   1        return 0;            
 232   1      }
 233          
 234          bit Searchfinger(void)//ËÑË÷Ö¸ÎÆ(·¢ËÍËÑË÷ÃüÁî¡¢ÒÔ¼°¸ù¾Ý·µ»ØÖµÈ·¶¨ÊÇ·ñ´æÔÚ)        
 235          {   
 236   1          if(Command(SEAT,60) && (FifoNumber==15) && (FIFO[9]==0x00) )  
 237   1          {
 238   2          SearchNumber=FIFO[10]*0x100+FIFO[11];//ËÑË÷µ½µÄÒ³Âë
 239   2          //MatchScore=FIFO[12]*0x100+FIFO[13]   ¿ÉÒÔÔÚ´Ë¼ÆËãµÃ·Ö£¬´Ó¶ø½øÐÐ°²È«¼¶±ðÉè¶¨£¬±¾³ÌÐòºöÂÔ
 240   2            return 1;
 241   2        }     
 242   1          else             
 243   1          {
 244   2              return 0;
 245   2          }  
 246   1      }
 247          
 248          
 249          unsigned char search(void)//ËÑË÷Ö¸ÎÆ 
 250          {
 251   1        
 252   1        unsigned char SearchBuf=0,i=0;
 253   1          while (i<20)
 254   1          {
 255   2            if (ImgProcess(1)==1)//Ê×ÏÈ¶ÁÈëÒ»´ÎÖ¸ÎÆ  
 256   2              {
 257   3                SearchBuf=Searchfinger();//½øÐÐÖ¸ÎÆ±È¶Ô£¬Èç¹ûËÑË÷µ½£¬·µ»ØËÑË÷µ½µÄÖ¸ÎÆÐòºÅ
 258   3                if(SearchBuf==1)
 259   3                  return SearchNumber; 
 260   3                else 
 261   3                  return 255;//±íÊ¾ËÑË÷µ½µÄÖ¸ÎÆ²»ÕýÈ·
 262   3             
 263   3              }
 264   2             i++; 
 265   2              if(idy_stop_flag)
 266   2              {
 267   3                idy_stop_flag=0;
 268   3                 return 0;
 269   3              }
 270   2              
 271   2          }
 272   1         return 0;
 273   1      }
 274          
 275          bit savefingure(unsigned char ID)//±£´æÖ¸ÎÆ
 276          {
 277   1         unsigned char i=0;
 278   1         //ÏÖÔÚ¿ªÊ¼½øÐÐ´æ´¢Ö¸ÎÆÄ£°åµÄ²Ù×÷
 279   1           for (i=0;i<16;i++) //±£´æÖ¸ÎÆÐÅÏ¢
 280   1         {
 281   2          FIFO[i]=STOR[i];
 282   2        }  
 283   1      
 284   1           FIFO[12]=ID; //°ÑÖ¸ÎÆÄ£°å´æ·ÅµÄPAGE_IDÒ²¾ÍÊÇFLASHµÄÎ»ÖÃ
 285   1           FIFO[14]=FIFO[14]+ID;  //Ð£ÑéºÍ
 286   1      
 287   1           if (Command(FIFO,70)==1)//´Ë´¦½øÐÐ´æ·ÅÖ¸ÎÆÄ£°åµÄÃüÁî
 288   1         {
 289   2           return(1);
 290   2         }
 291   1           else
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 6   

 292   1         {
 293   2           return(0);//²»³É¹¦·µ»Ø0
 294   2         } 
 295   1      }
 296          
 297          
 298          
 299          unsigned char enroll(void) //²É¼¯Á½´ÎÖ¸ÎÆ£¬Éú³É1¸ö Ö¸ÎÆÄ£°å
 300          {
 301   1        unsigned char temp=0,count=0;
 302   1          while(1)
 303   1          {
 304   2            temp=ImgProcess(1); //Éú³ÉÌØÕ÷1    
 305   2            if (temp==1)//Éú³ÉÌØÕ÷ÎÄ¼þ³É¹¦             
 306   2              {           
 307   3                //²É¼¯µÚÒ»¸öÌØÕ÷³É¹¦ 
 308   3              count=0;  
 309   3              buzzer=0;
 310   3            delay_ms(100);
 311   3            buzzer=1;
 312   3            break;
 313   3              }
 314   2            else                   
 315   2              {
 316   3                if (temp==0)//²É¼¯Ö¸ÎÆÃ»ÓÐ³É¹¦
 317   3                  { 
 318   4              count++;
 319   4                    if (count>=40)//Èç¹û²É¼¯ÁË40´Î£¬»¹²»³É¹¦£¬Ö±½Ó²É¼¯Ê§°Ü£¬Ö±½ÓÍË³öenrollº¯Êý£­£­£­£­·µ»Ø0  
 320   4                return(0);
 321   4                  }
 322   3              }
 323   2          }
 324   1      
 325   1        delay_ms(2000);//ÑÓÊ±2S¿ªÊ¼²É¼¯ÏÂÒ»¸öÌØÕ÷
 326   1      
 327   1        //¿ªÊ¼²É¼¯µÚ¶þ¸öÌØÕ÷ 
 328   1        while(1)
 329   1          {
 330   2            temp=ImgProcess(2); //Éú³ÉÌØÕ÷2    
 331   2            if (temp==1)//Éú³ÉÌØÕ÷ÎÄ¼þ2³É¹¦
 332   2              {
 333   3                if (  (Command(MERG,40)&& (FifoNumber==11) && (FIFO[9]==0x00))==1  ) //ºÏ²¢³É¹¦·µ»Ø1
 334   3            {
 335   4                 buzzer=0;
 336   4                     delay_ms(1000);
 337   4                     buzzer=1;
 338   4               delay_ms(1000);
 339   4               buzzer=0;
 340   4                     delay_ms(1000);  //ÏìÁ½Éù£¬±íÊ¾Éú³ÉÒ»¸öÄ£°å³É¹¦
 341   4                     buzzer=1; 
 342   4               return(1);
 343   4            }
 344   3            else
 345   3            {
 346   4               return(0);
 347   4            }   
 348   3              }
 349   2              else      
 350   2              { 
 351   3                if (temp==1)//²É¼¯Ö¸ÎÆÃ»ÓÐ³É¹¦
 352   3                {
 353   4                  count++;
C51 COMPILER V9.54   FPM                                                                   04/13/2019 23:32:08 PAGE 7   

 354   4                  if (count>=25) 
 355   4                  return(0);
 356   4                }
 357   3            }
 358   2          }
 359   1      }
 360          
 361          
 362          

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
